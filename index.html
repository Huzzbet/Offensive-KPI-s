<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shot Decision Tracker</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 12px;
      background: #0b1220;
      color: #f9fafb;
    }

    h1 {
      font-size: 20px;
      margin: 0 0 8px;
      text-align: center;
    }

    .subheading {
      font-size: 12px;
      text-align: center;
      margin-bottom: 12px;
      color: #9ca3af;
    }

    .card {
      background: #111827;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.4);
    }

    .section-title {
      font-size: 13px;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .btn-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      background: #1f2937;
      color: #e5e7eb;
      transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.1s ease;
    }

    button:active {
      transform: scale(0.97);
      box-shadow: 0 0 0 rgba(0,0,0,0.2);
    }

    button.selected {
      background: #10b981;
      color: #022c22;
      box-shadow: 0 0 0 1px #6ee7b7;
    }

    button.danger.selected {
      background: #ef4444;
      color: #7f1d1d;
      box-shadow: 0 0 0 1px #fecaca;
    }

    button.warning.selected {
      background: #f59e0b;
      color: #78350f;
      box-shadow: 0 0 0 1px #fed7aa;
    }

    button.small {
      padding: 6px 8px;
      font-size: 11px;
    }

    .primary-action {
      width: 100%;
      margin-top: 8px;
      padding: 10px;
      font-size: 14px;
      border-radius: 999px;
      background: #3b82f6;
      color: white;
    }

    .primary-action:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 11px;
      margin-top: 4px;
    }

    .stat-pill {
      padding: 4px 8px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #1f2937;
      color: #e5e7eb;
    }

    .stat-pill.bad {
      border-color: #b91c1c;
      color: #fecaca;
    }

    .stat-pill.good {
      border-color: #16a34a;
      color: #bbf7d0;
    }

    .stat-pill.warn {
      border-color: #f59e0b;
      color: #fed7aa;
    }

    .table-wrapper {
      max-height: 210px;
      overflow-y: auto;
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #1f2937;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    th, td {
      padding: 4px 6px;
      text-align: center;
      border-bottom: 1px solid #111827;
      white-space: nowrap;
    }

    th {
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
    }

    tr:nth-child(even) {
      background: #020617;
    }

    textarea {
      width: 100%;
      min-height: 90px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      padding: 6px;
      font-size: 11px;
      resize: vertical;
      background: #020617;
      color: #f9fafb;
    }

    .footer-actions {
      display: flex;
      gap: 8px;
      margin-top: 6px;
    }

    .footer-actions button {
      flex: 1;
    }

    @media (min-width: 768px) {
      body {
        max-width: 480px;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <h1>Shot Decision Tracker</h1>
  <div class="subheading">P1 / P2 / NS • Shot Quality • Decision Quality</div>

  <!-- Selection Controls -->
  <div class="card">
    <div class="section-title">1. Shooter Role</div>
    <div class="btn-row" id="roleButtons">
      <button data-role="P1">P1 – Primary</button>
      <button data-role="P2">P2 – Secondary</button>
      <button data-role="NS">NS – Non-shooter</button>
    </div>

    <div class="section-title" style="margin-top:10px;">2. Shot Quality</div>
    <div class="btn-row" id="qualityButtons">
      <button data-quality="G" class="good">G – Great</button>
      <button data-quality="O" class="warn">O – OK</button>
      <button data-quality="P" class="danger">P – Poor</button>
    </div>

    <div class="section-title" style="margin-top:10px;">3. Decision Quality</div>
    <div class="btn-row" id="decisionButtons">
      <button data-decision="C">C – Correct</button>
      <button data-decision="I" class="danger">I – Incorrect</button>
    </div>

    <button id="saveBtn" class="primary-action" disabled>+ Save Possession</button>
  </div>

  <!-- Stats -->
  <div class="card">
    <div class="section-title">Quarter Summary (Live)</div>
    <div class="stats-row" id="statsRow">
      <!-- Filled by JS -->
    </div>
  </div>

  <!-- Log -->
  <div class="card">
    <div class="section-title">Possession Log</div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Role</th>
            <th>Shot</th>
            <th>Decision</th>
          </tr>
        </thead>
        <tbody id="logBody">
          <!-- Filled by JS -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Report -->
  <div class="card">
    <div class="section-title">Coach Report (Q Break)</div>
    <textarea id="reportBox" readonly></textarea>
    <div class="footer-actions">
      <button class="small" id="copyReportBtn">Copy Text</button>
      <button class="small" id="resetQuarterBtn">Reset Quarter</button>
    </div>
  </div>

  <script>
    const state = {
      role: null,
      quality: null,
      decision: null,
      possessions: []
    };

    const roleButtons = document.getElementById('roleButtons');
    const qualityButtons = document.getElementById('qualityButtons');
    const decisionButtons = document.getElementById('decisionButtons');
    const saveBtn = document.getElementById('saveBtn');
    const logBody = document.getElementById('logBody');
    const statsRow = document.getElementById('statsRow');
    const reportBox = document.getElementById('reportBox');
    const resetQuarterBtn = document.getElementById('resetQuarterBtn');
    const copyReportBtn = document.getElementById('copyReportBtn');

    function handleToggle(groupElement, key, valueAttr, extraClassLogic) {
      const buttons = groupElement.querySelectorAll('button');
      buttons.forEach(btn => {
        btn.classList.remove('selected', 'danger', 'warning', 'good');
        // keep base classes from HTML
      });
      const selectedBtn = groupElement.querySelector(`[${valueAttr}="${state[key]}"]`);
      if (selectedBtn) selectedBtn.classList.add('selected');
    }

    // Role buttons
    roleButtons.addEventListener('click', (e) => {
      if (e.target.tagName !== 'BUTTON') return;
      state.role = e.target.getAttribute('data-role');
      roleButtons.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
      e.target.classList.add('selected');
      updateSaveButton();
    });

    // Shot quality buttons
    qualityButtons.addEventListener('click', (e) => {
      if (e.target.tagName !== 'BUTTON') return;
      state.quality = e.target.getAttribute('data-quality');
      qualityButtons.querySelectorAll('button').forEach(btn => {
        btn.classList.remove('selected','danger','warning','good');
      });
      e.target.classList.add('selected');
      if (state.quality === 'G') e.target.classList.add('good');
      if (state.quality === 'O') e.target.classList.add('warning');
      if (state.quality === 'P') e.target.classList.add('danger');
      updateSaveButton();
    });

    // Decision buttons
    decisionButtons.addEventListener('click', (e) => {
      if (e.target.tagName !== 'BUTTON') return;
      state.decision = e.target.getAttribute('data-decision');
      decisionButtons.querySelectorAll('button').forEach(btn => {
        btn.classList.remove('selected','danger');
      });
      e.target.classList.add('selected');
      if (state.decision === 'I') e.target.classList.add('danger');
      updateSaveButton();
    });

    function updateSaveButton() {
      if (state.role && state.quality && state.decision) {
        saveBtn.disabled = false;
      } else {
        saveBtn.disabled = true;
      }
    }

    saveBtn.addEventListener('click', () => {
      if (!state.role || !state.quality || !state.decision) return;

      const possession = {
        role: state.role,
        quality: state.quality,
        decision: state.decision
      };
      state.possessions.push(possession);

      // Append to table
      const row = document.createElement('tr');
      const idxCell = document.createElement('td');
      idxCell.textContent = state.possessions.length;
      const roleCell = document.createElement('td');
      roleCell.textContent = possession.role;
      const qualCell = document.createElement('td');
      qualCell.textContent = possession.quality;
      const decCell = document.createElement('td');
      decCell.textContent = possession.decision;
      row.appendChild(idxCell);
      row.appendChild(roleCell);
      row.appendChild(qualCell);
      row.appendChild(decCell);
      logBody.appendChild(row);

      // Clear selections
      state.role = null;
      state.quality = null;
      state.decision = null;
      [roleButtons, qualityButtons, decisionButtons].forEach(group => {
        group.querySelectorAll('button').forEach(btn => {
          btn.classList.remove('selected','danger','warning','good');
        });
      });
      updateSaveButton();
      updateStats();
      updateReport();
    });

    function perc(part, total) {
      if (!total) return 0;
      return Math.round((part / total) * 100);
    }

    function updateStats() {
      const total = state.possessions.length;
      let p1 = 0, p2 = 0, ns = 0;
      let g = 0, o = 0, p = 0;
      let c = 0, i = 0;

      state.possessions.forEach(pos => {
        if (pos.role === 'P1') p1++;
        if (pos.role === 'P2') p2++;
        if (pos.role === 'NS') ns++;
        if (pos.quality === 'G') g++;
        if (pos.quality === 'O') o++;
        if (pos.quality === 'P') p++;
        if (pos.decision === 'C') c++;
        if (pos.decision === 'I') i++;
      });

      const goodShots = g + o;
      const goodShotPerc = perc(goodShots, total);
      const correctPerc = perc(c, total);

      statsRow.innerHTML = '';

      const pills = [];

      pills.push(`Total shots: ${total}`);

      pills.push(`P1: ${p1} (${perc(p1,total)}%)`);
      pills.push(`P2: ${p2} (${perc(p2,total)}%)`);
      pills.push(`NS: ${ns} (${perc(ns,total)}%)`);

      pills.push(`G/O: ${goodShots}/${total} (${goodShotPerc}%)`);
      pills.push(`Poor: ${p} (${perc(p,total)}%)`);

      pills.push(`Correct: ${c}/${total} (${correctPerc}%)`);
      pills.push(`Incorrect: ${i} (${perc(i,total)}%)`);

      pills.forEach(text => {
        const div = document.createElement('div');
        div.classList.add('stat-pill');

        if (text.startsWith('NS') && total && ns/total > 0.2) {
          div.classList.add('bad');
        }
        if (text.startsWith('G/O') && goodShotPerc >= 70) {
          div.classList.add('good');
        } else if (text.startsWith('G/O') && goodShotPerc < 55) {
          div.classList.add('bad');
        }
        if (text.startsWith('Correct')) {
          if (correctPerc >= 75) div.classList.add('good');
          else if (correctPerc < 65) div.classList.add('bad');
          else div.classList.add('warn');
        }

        div.textContent = text;
        statsRow.appendChild(div);
      });
    }

    function updateReport() {
      const total = state.possessions.length;
      if (!total) {
        reportBox.value = "No possessions logged yet. Start tracking shots to generate a report.";
        return;
      }

      let p1 = 0, p2 = 0, ns = 0;
      let g = 0, o = 0, p = 0;
      let c = 0, i = 0;

      state.possessions.forEach(pos => {
        if (pos.role === 'P1') p1++;
        if (pos.role === 'P2') p2++;
        if (pos.role === 'NS') ns++;
        if (pos.quality === 'G') g++;
        if (pos.quality === 'O') o++;
        if (pos.quality === 'P') p++;
        if (pos.decision === 'C') c++;
        if (pos.decision === 'I') i++;
      });

      const goodShots = g + o;
      const goodShotPerc = perc(goodShots,total);
      const correctPerc = perc(c,total);

      let lines = [];

      lines.push(`Quarter Shot Selection Report`);
      lines.push(`Total shots: ${total}`);
      lines.push('');
      lines.push(`Role distribution:`);
      lines.push(`- P1 shooters: ${p1} (${perc(p1,total)}%)`);
      lines.push(`- P2 shooters: ${p2} (${perc(p2,total)}%)`);
      lines.push(`- Non-shooters: ${ns} (${perc(ns,total)}%)`);
      lines.push('');
      lines.push(`Shot quality:`);
      lines.push(`- Great / OK: ${goodShots}/${total} (${goodShotPerc}%)`);
      lines.push(`- Poor shots: ${p} (${perc(p,total)}%)`);
      lines.push('');
      lines.push(`Decision quality:`);
      lines.push(`- Correct decisions: ${c}/${total} (${correctPerc}%)`);
      lines.push(`- Incorrect: ${i}/${total} (${perc(i,total)}%)`);
      lines.push('');
      lines.push(`Key messages for team (edit as needed):`);

      if (ns/total > 0.2) {
        lines.push(`- Too many shots from non-shooters – get the ball back to P1/P2.`);
      } else {
        lines.push(`- Shot volume from primary/secondary shooters is acceptable.`);
      }

      if (goodShotPerc < 55) {
        lines.push(`- Too many poor shots – slow down, get a paint touch, and generate cleaner looks.`);
      } else if (goodShotPerc >= 70) {
        lines.push(`- Good overall shot quality – keep hunting paint touches and kick-outs.`);
      }

      if (correctPerc < 65) {
        lines.push(`- Decision making below target – need better recognition of who should shoot.`);
      } else if (correctPerc >= 75) {
        lines.push(`- Strong decision making – players mostly choosing the right options.`);
      }

      reportBox.value = lines.join('\n');
    }

    resetQuarterBtn.addEventListener('click', () => {
      if (!confirm("Reset quarter data? This will clear all possessions.")) return;
      state.possessions = [];
      logBody.innerHTML = '';
      updateStats();
      updateReport();
    });

    copyReportBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(reportBox.value);
        copyReportBtn.textContent = "Copied!";
        setTimeout(() => copyReportBtn.textContent = "Copy Text", 1200);
      } catch (err) {
        alert("Copy not supported here. You can select and copy manually.");
      }
    });

    // Initialise
    updateStats();
    updateReport();
  </script>
</body>
</html>
