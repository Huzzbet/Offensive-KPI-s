<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shot Decision Tracker</title>
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 20px;
      background: #020617; /* deep navy */
      color: #e5e7eb;
    }

    h1 {
      font-size: 24px;
      margin: 0 0 8px;
      text-align: center;
    }

    .subheading {
      font-size: 13px;
      text-align: center;
      margin-bottom: 16px;
      color: #9ca3af;
    }

    .app-shell {
      max-width: 520px;
      margin: 0 auto;
    }

    .pill-indicators {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
      font-size: 11px;
      color: #9ca3af;
      flex-wrap: wrap;
    }
    .pill-indicators span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .pill-indicators span::before {
      content: "";
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #4b5563;
    }

    .info-banner {
      background: #020617;
      border-radius: 16px;
      padding: 12px 14px;
      border: 1px solid #1f2937;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }
    .info-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    .info-label {
      color: #9ca3af;
      font-weight: 500;
    }
    .info-value {
      color: #e5e7eb;
      font-weight: 500;
    }

    .card {
      background: #020617;
      border-radius: 16px;
      padding: 16px;
      border: 1px solid #111827;
      margin-bottom: 16px;
      box-shadow:
        0 18px 35px rgba(15,23,42,0.85),
        0 0 0 1px rgba(15,23,42,0.9);
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .card-subtitle {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    /* Player grid */
    .player-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .player-card {
      position: relative;
      border-radius: 14px;
      border: 1px solid #1f2937;
      background: radial-gradient(circle at top left, rgba(15,23,42,0.9), #020617);
      padding: 10px 10px 10px;
      text-align: left;
      cursor: pointer;
      transition:
        transform 0.12s ease-out,
        box-shadow 0.12s ease-out,
        border-color 0.12s ease-out,
        background 0.15s ease-out;
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow: hidden;
      color: #e5e7eb; /* force text colour */
    }

    /* make whole tile clickable even when tapping text/pill */
    .player-card * {
      pointer-events: none;
    }

    .player-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15,23,42,0.9);
      border-color: #374151;
    }

    .player-number {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .player-name {
      font-size: 13px;
      font-weight: 500;
      color: #e5e7eb;
    }

    /* Role chip */
    .role-pill {
      margin-top: 4px;
      align-self: flex-start;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      border-width: 1px;
      border-style: solid;
      background: rgba(15,23,42,0.9);
    }
    .role-primary {
      border-color: #22c55e;
      color: #bbf7d0;
    }
    .role-secondary {
      border-color: #38bdf8;
      color: #bae6fd;
    }
    .role-ns {
      border-color: #a855f7;
      color: #e9d5ff;
    }

    /* SELECTED STATE – keep text & pill visible */
    .player-card.selected {
      border-color: #22c55e;
      background:
        radial-gradient(circle at top left, rgba(34,197,94,0.25), #020617);
      box-shadow:
        0 0 0 1px rgba(34,197,94,0.45),
        0 18px 40px rgba(15,23,42,0.95);
    }
    .player-card.selected .player-number,
    .player-card.selected .player-name {
      color: #ecfeff;
    }
    .player-card.selected .role-pill {
      background: rgba(15,23,42,0.95);
    }

    /* Button groups */
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }
    .chip {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      font-size: 13px;
      cursor: pointer;
      color: #e5e7eb;
      min-width: 70px;
      text-align: center;
      transition:
        background 0.12s ease-out,
        border-color 0.12s ease-out,
        color 0.12s ease-out,
        transform 0.12s ease-out;
    }
    .chip span {
      font-weight: 600;
      margin-right: 4px;
    }
    .chip:hover {
      transform: translateY(-0.5px);
      border-color: #374151;
    }
    .chip.selected {
      border-color: #38bdf8;
      background: radial-gradient(circle at top left, rgba(59,130,246,0.24), #020617);
      box-shadow:
        0 0 0 1px rgba(37,99,235,0.4),
        0 12px 26px rgba(15,23,42,0.8);
    }

    /* Action buttons */
    .actions-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 14px;
    }
    .btn {
      border-radius: 999px;
      padding: 12px 16px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition:
        transform 0.08s ease-out,
        box-shadow 0.12s ease-out,
        opacity 0.12s ease-out;
    }
    .btn-primary {
      background: linear-gradient(to right, #2563eb, #22c55e);
      color: white;
      box-shadow: 0 12px 28px rgba(37,99,235,0.55);
    }
    .btn-secondary {
      background: #111827;
      color: #e5e7eb;
      border: 1px solid #1f2937;
    }
    .btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 4px 12px rgba(15,23,42,0.9);
    }
    .btn[disabled] {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
    }

    .clear-row {
      margin-top: 10px;
      display: flex;
      justify-content: center;
    }
    .clear-button {
      border-radius: 999px;
      padding: 8px 14px;
      border: none;
      font-size: 13px;
      background: #111827;
      color: #9ca3af;
      cursor: pointer;
    }

    /* Summary */
    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
      color: #9ca3af;
    }
    .summary-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .summary-tag {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      color: #9ca3af;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      font-size: 11px;
    }
    .summary-item {
      padding: 8px 8px;
      border-radius: 10px;
      background: #020617;
      border: 1px solid #0f172a;
    }
    .summary-label {
      color: #9ca3af;
      margin-bottom: 2px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .summary-value {
      font-weight: 600;
      color: #e5e7eb;
    }

    .footer-note {
      margin-top: 12px;
      font-size: 10px;
      color: #6b7280;
      text-align: center;
    }

    @media (max-width: 480px) {
      body {
        padding: 16px 12px 24px;
      }
      .card {
        padding: 14px;
      }
      .player-number {
        font-size: 16px;
      }
      .player-name {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <h1>Shot Decision Tracker</h1>
    <div class="subheading">
      Player • Shot Quality • Decision Quality (Roles: P1 / P2 / NS)
    </div>

    <div class="pill-indicators">
      <span>Player</span>
      <span>Shot Quality</span>
      <span>Decision Quality</span>
    </div>

    <div class="info-banner">
      <div class="info-row">
        <span class="info-label">Current Quarter:</span>
        <span class="info-value" id="currentQuarterLabel">Q1</span>
      </div>
      <div class="info-row">
        <span class="info-label">Targets:</span>
        <span class="info-value">
          P1/P2 shots, 70%+ looks, 75%+ correct
        </span>
      </div>
    </div>

    <!-- PLAYER SELECTION -->
    <div class="card">
      <div class="card-title">1. Player</div>
      <div class="card-subtitle">
        Tap the player who finished the possession (Primary / Secondary / Non-Shooter)
      </div>

      <div class="player-grid" id="playerGrid">
        <!-- Primary -->
        <div class="player-card" data-player-id="23" data-role="P1">
          <div class="player-number">#23</div>
          <div class="player-name">Primary Scorer</div>
          <div class="role-pill role-primary">Primary</div>
        </div>

        <!-- Secondary -->
        <div class="player-card" data-player-id="5" data-role="P2">
          <div class="player-number">#5</div>
          <div class="player-name">Cal Ralmer</div>
          <div class="role-pill role-secondary">Secondary</div>
        </div>

        <div class="player-card" data-player-id="9" data-role="NS">
          <div class="player-number">#9</div>
          <div class="player-name">Thomas D'Amelio</div>
          <div class="role-pill role-ns">Non-Shooter</div>
        </div>

        <div class="player-card" data-player-id="22" data-role="P2">
          <div class="player-number">#22</div>
          <div class="player-name">Oliver Mann</div>
          <div class="role-pill role-secondary">Secondary</div>
        </div>

        <div class="player-card" data-player-id="32" data-role="P2">
          <div class="player-number">#32</div>
          <div class="player-name">Oliver Ledger</div>
          <div class="role-pill role-secondary">Secondary</div>
        </div>

        <div class="player-card" data-player-id="14" data-role="NS">
          <div class="player-number">#14</div>
          <div class="player-name">Charlie Watts</div>
          <div class="role-pill role-ns">Non-Shooter</div>
        </div>
      </div>
    </div>

    <!-- SHOT QUALITY -->
    <div class="card">
      <div class="card-title">2. Shot Quality</div>
      <div class="card-subtitle">
        G = great look, O = ok look, P = poor/forced
      </div>
      <div class="chip-row" id="shotQualityRow">
        <button class="chip" data-shot="G"><span>G</span>Great</button>
        <button class="chip" data-shot="O"><span>O</span>OK</button>
        <button class="chip" data-shot="P"><span>P</span>Poor</button>
      </div>
    </div>

    <!-- DECISION QUALITY -->
    <div class="card">
      <div class="card-title">3. Decision Quality</div>
      <div class="card-subtitle">
        C = correct player/shot, I = incorrect choice
      </div>
      <div class="chip-row" id="decisionQualityRow">
        <button class="chip" data-decision="C"><span>C</span>Correct</button>
        <button class="chip" data-decision="I"><span>I</span>Incorrect</button>
      </div>

      <div class="clear-row">
        <button class="clear-button" id="clearSelectionBtn">Clear Selection</button>
      </div>

      <div class="actions-row">
        <button class="btn btn-primary" id="savePossessionBtn">
          + Save Possession
        </button>
        <button class="btn btn-secondary" id="undoBtn">
          ⟲ Undo Last Possession
        </button>
      </div>
    </div>

    <!-- QUARTER SUMMARY -->
    <div class="card">
      <div class="summary-header">
        <span>Quarter Summary (Live)</span>
        <div class="summary-tags">
          <span class="summary-tag" id="qPossessionsTag">0 Possessions</span>
          <span class="summary-tag" id="qLooksTag">Looks: 0% G/O</span>
          <span class="summary-tag" id="qDecisionTag">Correct: 0%</span>
        </div>
      </div>

      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">P1 Shots</div>
          <div class="summary-value" id="qP1Shots">0</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">P2 Shots</div>
          <div class="summary-value" id="qP2Shots">0</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">NS Shots</div>
          <div class="summary-value" id="qNSShots">0</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Great / OK</div>
          <div class="summary-value" id="qGreatOk">0 / 0</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Poor Looks</div>
          <div class="summary-value" id="qPoorLooks">0</div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Correct / Incorrect</div>
          <div class="summary-value" id="qCorrectIncorrect">0 / 0</div>
        </div>
      </div>
      <div class="footer-note">
        Tip: aim for majority P1/P2 finishes, 70%+ good looks &gt; 75% correct decisions.
      </div>
    </div>
  </div>

  <script>
    // --- STATE ---
    let currentQuarter = 1;
    const maxQuarters = 4;

    const quarters = {
      1: [],
      2: [],
      3: [],
      4: []
    };

    const selection = {
      playerId: null,
      role: null,
      shotQuality: null,
      decisionQuality: null
    };

    // --- HELPERS ---
    function resetSelection() {
      selection.playerId = null;
      selection.role = null;
      selection.shotQuality = null;
      selection.decisionQuality = null;

      document.querySelectorAll(".player-card").forEach(card =>
        card.classList.remove("selected")
      );
      document.querySelectorAll("#shotQualityRow .chip").forEach(chip =>
        chip.classList.remove("selected")
      );
      document.querySelectorAll("#decisionQualityRow .chip").forEach(chip =>
        chip.classList.remove("selected")
      );
    }

    function updateQuarterLabel() {
      document.getElementById("currentQuarterLabel").textContent = "Q" + currentQuarter;
    }

    function calculateQuarterStats(qNum) {
      const data = quarters[qNum];
      const total = data.length;

      let p1 = 0, p2 = 0, ns = 0;
      let g = 0, o = 0, p = 0;
      let correct = 0, incorrect = 0;

      data.forEach(poss => {
        if (poss.role === "P1") p1++;
        else if (poss.role === "P2") p2++;
        else if (poss.role === "NS") ns++;

        if (poss.shotQuality === "G") g++;
        else if (poss.shotQuality === "O") o++;
        else if (poss.shotQuality === "P") p++;

        if (poss.decisionQuality === "C") correct++;
        else if (poss.decisionQuality === "I") incorrect++;
      });

      const goodLooks = g + o;
      const looksPct = total ? Math.round((goodLooks / total) * 100) : 0;
      const correctPct = total ? Math.round((correct / total) * 100) : 0;

      return {
        total,
        p1,
        p2,
        ns,
        g,
        o,
        p,
        correct,
        incorrect,
        looksPct,
        correctPct
      };
    }

    function renderQuarterSummary() {
      const stats = calculateQuarterStats(currentQuarter);

      document.getElementById("qP1Shots").textContent = stats.p1;
      document.getElementById("qP2Shots").textContent = stats.p2;
      document.getElementById("qNSShots").textContent = stats.ns;

      document.getElementById("qGreatOk").textContent = stats.g + " / " + stats.o;
      document.getElementById("qPoorLooks").textContent = stats.p;

      document.getElementById("qCorrectIncorrect").textContent =
        stats.correct + " / " + stats.incorrect;

      document.getElementById("qPossessionsTag").textContent =
        stats.total + " Possessions";
      document.getElementById("qLooksTag").textContent =
        "Looks: " + stats.looksPct + "% G/O";
      document.getElementById("qDecisionTag").textContent =
        "Correct: " + stats.correctPct + "%";
    }

    function ensureValidSelection() {
      return (
        selection.playerId &&
        selection.role &&
        selection.shotQuality &&
        selection.decisionQuality
      );
    }

    // --- LISTENERS ---

    // Player selection
    document.querySelectorAll(".player-card").forEach(card => {
      card.addEventListener("click", () => {
        const alreadySelected = card.classList.contains("selected");

        // Clear all first
        document.querySelectorAll(".player-card").forEach(c =>
          c.classList.remove("selected")
        );

        if (alreadySelected) {
          // toggle off
          selection.playerId = null;
          selection.role = null;
        } else {
          card.classList.add("selected");
          selection.playerId = card.dataset.playerId;
          selection.role = card.dataset.role;
        }
      });
    });

    // Shot quality
    document.querySelectorAll("#shotQualityRow .chip").forEach(chip => {
      chip.addEventListener("click", () => {
        document
          .querySelectorAll("#shotQualityRow .chip")
          .forEach(c => c.classList.remove("selected"));
        chip.classList.add("selected");
        selection.shotQuality = chip.dataset.shot;
      });
    });

    // Decision quality
    document.querySelectorAll("#decisionQualityRow .chip").forEach(chip => {
      chip.addEventListener("click", () => {
        document
          .querySelectorAll("#decisionQualityRow .chip")
          .forEach(c => c.classList.remove("selected"));
        chip.classList.add("selected");
        selection.decisionQuality = chip.dataset.decision;
      });
    });

    // Clear selection
    document.getElementById("clearSelectionBtn").addEventListener("click", () => {
      resetSelection();
    });

    // Save possession
    document.getElementById("savePossessionBtn").addEventListener("click", () => {
      if (!ensureValidSelection()) {
        alert("Please select player, shot quality and decision quality.");
        return;
      }

      const poss = {
        playerId: selection.playerId,
        role: selection.role,
        shotQuality: selection.shotQuality,
        decisionQuality: selection.decisionQuality
      };

      quarters[currentQuarter].push(poss);
      renderQuarterSummary();
      resetSelection();
    });

    // Undo last possession
    document.getElementById("undoBtn").addEventListener("click", () => {
      if (quarters[currentQuarter].length === 0) return;
      quarters[currentQuarter].pop();
      renderQuarterSummary();
    });

    // Initial render
    updateQuarterLabel();
    renderQuarterSummary();
  </script>
</body>
</html>
