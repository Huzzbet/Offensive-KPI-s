<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shot Decision Tracker</title>

  <style>
    /* RESET + BASE --------------------------------------------- */
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background: #0b1220;
      color: #f9fafb;
    }

    h1 {
      font-size: 24px;
      margin: 0 0 8px;
      text-align: center;
    }

    .subheading {
      font-size: 14px;
      text-align: center;
      margin-bottom: 16px;
      color: #9ca3af;
    }

    /* TEXT SELECTION FIX (iOS BLUE FLASH FIX) ------------------- */
    button {
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }

    /* LAYOUT ---------------------------------------------------- */
    .container {
      max-width: 520px;
      margin: 0 auto;
    }

    .card {
      background: #111827;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    }

    .section-title {
      font-size: 15px;
      margin-bottom: 8px;
      font-weight: 600;
      color: #e5e7eb;
    }

    .pill-label {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    /* BUTTONS --------------------------------------------------- */
    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: #1f2937;
      color: #e5e7eb;
      transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.1s ease;
    }

    button:active {
      transform: scale(0.97);
    }

    button.selected {
      background: #10b981;
      color: #022c22;
      box-shadow: 0 0 0 1px #6ee7b7;
    }

    button.danger.selected { background:#ef4444; color:#7f1d1d; }
    button.warning.selected { background:#f59e0b; color:#78350f; }

    .small {
      padding: 8px 10px;
      font-size: 11px;
    }

    .primary-action {
      width: 100%;
      padding: 12px;
      margin-top: 12px;
      font-size: 16px;
      border-radius: 999px;
      background: #3b82f6;
      color: white;
    }

    .primary-action:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* PROFESSIONAL PLAYER BUTTONS ------------------------------- */
    .player-button {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 150px;
      background: #020617;
      border: 1px solid #1f2937;
      border-radius: 12px;
      padding: 8px 10px;
      text-align: left;
    }

    .player-button.selected {
      background: #022c22;
      border-color: #10b981;
      box-shadow: 0 0 0 1px #6ee7b7;
    }

    .player-number {
      font-size: 11px;
      color: #9ca3af;
    }

    .player-name {
      font-size: 13px;
      font-weight: 600;
    }

    .role-chip {
      margin-top: 2px;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid;
    }

    .role-p1 { border-color:#22c55e; color:#bbf7d0; }
    .role-p2 { border-color:#38bdf8; color:#bae6fd; }
    .role-ns { border-color:#a855f7; color:#e9d5ff; }

    /* STATS ------------------------------------------------------ */
    .stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 12px;
      margin-top: 6px;
    }

    .stat-pill {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
    }

    .stat-pill.good { border-color:#16a34a; color:#bbf7d0; }
    .stat-pill.bad  { border-color:#b91c1c; color:#fecaca; }
    .stat-pill.warn { border-color:#f59e0b; color:#fed7aa; }

    /* TABLE ------------------------------------------------------ */
    .table-wrapper {
      max-height: 220px;
      overflow-y: auto;
      border-radius: 10px;
      border: 1px solid #1f2937;
      margin-top: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    th, td {
      padding: 6px 8px;
      text-align: center;
      border-bottom: 1px solid #111827;
      white-space: nowrap;
    }

    th {
      position: sticky;
      top: 0;
      background: #020617;
    }

    textarea {
      width: 100%;
      min-height: 100px;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #f9fafb;
      resize: vertical;
      font-size: 12px;
    }

    .footer-actions {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }

    .footer-actions button {
      flex: 1;
    }

    /* ARCHIVED QUARTERS ------------------------------------------ */
    .quarter-box {
      background: #1f2937;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .quarter-header {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .quarter-tag {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #3b82f6;
      color: #bfdbfe;
    }

    .top-quarter-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #9ca3af;
    }

    @media (min-width:768px) {
      body { padding: 40px 0; }
      .container { max-width: 600px; }
    }
  </style>

</head>
<body>
<div class="container">

  <h1>Shot Decision Tracker</h1>
  <div class="subheading">Player ● Shot Quality ● Decision Quality (Roles: P1 / P2 / NS)</div>

  <!-- Quarter Info -->
  <div class="card">
    <div class="top-quarter-row">
      <div><strong>Current Quarter:</strong> <span id="currentQuarterLabel">Q1</span></div>
      <div style="font-size:11px;">Targets: P1/P2 shots, 70%+ looks, 75%+ correct</div>
    </div>
  </div>

  <!-- PLAYER SELECTION -->
  <div class="card">
    <div class="section-title">1. Player</div>

    <div class="btn-row" id="playerButtons">

      <button class="player-button" data-player="23">
        <span class="player-number">#23</span>
        <span class="player-name">Michael Aminov</span>
        <span class="role-chip role-p1">Primary</span>
      </button>

      <button class="player-button" data-player="5">
        <span class="player-number">#5</span>
        <span class="player-name">Cal Ralmer</span>
        <span class="role-chip role-p2">Secondary</span>
      </button>

      <button class="player-button" data-player="9">
        <span class="player-number">#9</span>
        <span class="player-name">Thomas D'Amelio</span>
        <span class="role-chip role-ns">Non-Shooter</span>
      </button>

      <button class="player-button" data-player="22">
        <span class="player-number">#22</span>
        <span class="player-name">Oliver Mann</span>
        <span class="role-chip role-p2">Secondary</span>
      </button>

      <button class="player-button" data-player="32">
        <span class="player-number">#32</span>
        <span class="player-name">Oliver Ledger</span>
        <span class="role-chip role-p2">Secondary</span>
      </button>

      <button class="player-button" data-player="14">
        <span class="player-number">#14</span>
        <span class="player-name">Charlie Watts</span>
        <span class="role-chip role-ns">Non-Shooter</span>
      </button>

    </div>

    <!-- Shot Quality -->
    <div class="section-title" style="margin-top:14px;">2. Shot Quality</div>
    <div class="pill-label">G = great look, O = ok look, P = poor/forced</div>

    <div class="btn-row" id="qualityButtons">
      <button data-quality="G">G – Great</button>
      <button data-quality="O">O – OK</button>
      <button data-quality="P">P – Poor</button>
    </div>

    <!-- Decision -->
    <div class="section-title" style="margin-top:14px;">3. Decision Quality</div>
    <div class="pill-label">C = correct player/shot, I = incorrect choice</div>

    <div class="btn-row" id="decisionButtons">
      <button data-decision="C">C – Correct</button>
      <button data-decision="I">I – Incorrect</button>
    </div>

    <div class="footer-actions">
      <button class="small" id="clearSelectionBtn">Clear Selection</button>
    </div>

    <button id="saveBtn" class="primary-action" disabled>+ Save Possession</button>
  </div>

  <!-- LIVE STATS -->
  <div class="card">
    <div class="section-title">Quarter Summary (Live)</div>
    <div class="stats-row" id="statsRow"></div>
  </div>

  <!-- LOG -->
  <div class="card">
    <div class="section-title">Possession Log</div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Player</th>
            <th>Role</th>
            <th>Shot</th>
            <th>Decision</th>
          </tr>
        </thead>
        <tbody id="logBody"></tbody>
      </table>
    </div>

    <div class="footer-actions">
      <button class="small" id="undoLastBtn">Undo Last</button>
      <button class="small" id="resetQuarterBtn">Reset Quarter</button>
    </div>
  </div>

  <!-- REPORT -->
  <div class="card">
    <div class="section-title">Coach Report (Q Break)</div>
    <textarea id="reportBox" readonly></textarea>

    <div class="footer-actions">
      <button class="small" id="copyReportBtn">Copy Text</button>
      <button class="small" id="finalizeQuarterBtn" disabled>Finalize Quarter</button>
    </div>
  </div>

  <!-- ARCHIVES -->
  <div class="card">
    <div class="section-title">Archived Quarters</div>
    <div id="archivesContainer"></div>
  </div>

</div> <!-- container end -->

<script>
/* -------------------------------------------------------------
   DATA + STATE
-------------------------------------------------------------- */
const players = [
  { id:"23", number:23, name:"Michael Aminov", role:"P1" },
  { id:"5",  number:5,  name:"Cal Ralmer",     role:"P2" },
  { id:"9",  number:9,  name:"Thomas D'Amelio", role:"NS" },
  { id:"22", number:22, name:"Oliver Mann",    role:"P2" },
  { id:"32", number:32, name:"Oliver Ledger",  role:"P2" },
  { id:"14", number:14, name:"Charlie Watts",  role:"NS" }
];

const state = {
  currentQuarter: 1,
  playerId: null,
  quality: null,
  decision: null,
  possessions: []
};

/* -------------------------------------------------------------
   DOM ELEMENTS
-------------------------------------------------------------- */
const currentQuarterLabel = document.getElementById('currentQuarterLabel');
const playerButtons       = document.getElementById('playerButtons');
const qualityButtons      = document.getElementById('qualityButtons');
const decisionButtons     = document.getElementById('decisionButtons');
const saveBtn             = document.getElementById('saveBtn');
const clearSelectionBtn   = document.getElementById('clearSelectionBtn');
const logBody             = document.getElementById('logBody');
const statsRow            = document.getElementById('statsRow');
const reportBox           = document.getElementById('reportBox');
const undoLastBtn         = document.getElementById('undoLastBtn');
const resetQuarterBtn     = document.getElementById('resetQuarterBtn');
const finalizeQuarterBtn  = document.getElementById('finalizeQuarterBtn');
const copyReportBtn       = document.getElementById('copyReportBtn');
const archivesContainer   = document.getElementById('archivesContainer');

/* -------------------------------------------------------------
   UTILS
-------------------------------------------------------------- */
function perc(part, total) {
  if (!total) return 0;
  return Math.round((part / total) * 100);
}

function updateQuarterLabel() {
  currentQuarterLabel.textContent = "Q" + state.currentQuarter;
}

function updateSaveButton() {
  saveBtn.disabled = !(state.playerId && state.quality && state.decision);
}

/* -------------------------------------------------------------
   SELECTION HANDLERS
-------------------------------------------------------------- */
playerButtons.addEventListener('click', (e) => {
  const btn = e.target.closest('button');
  if (!btn) return;

  state.playerId = btn.getAttribute('data-player');

  playerButtons.querySelectorAll('button')
    .forEach(b => b.classList.remove('selected'));

  btn.classList.add('selected');
  updateSaveButton();
});

qualityButtons.addEventListener('click', (e) => {
  const btn = e.target.closest('button');
  if (!btn) return;

  state.quality = btn.getAttribute('data-quality');

  qualityButtons.querySelectorAll('button')
    .forEach(b => b.classList.remove('selected', 'warning', 'danger'));

  btn.classList.add('selected');
  if (state.quality === 'O') btn.classList.add('warning');
  if (state.quality === 'P') btn.classList.add('danger');

  updateSaveButton();
});

decisionButtons.addEventListener('click', (e) => {
  const btn = e.target.closest('button');
  if (!btn) return;

  state.decision = btn.getAttribute('data-decision');

  decisionButtons.querySelectorAll('button')
    .forEach(b => b.classList.remove('selected', 'danger'));

  btn.classList.add('selected');
  if (state.decision === 'I') btn.classList.add('danger');

  updateSaveButton();
});

/* -------------------------------------------------------------
   CLEAR SELECTION (undo before saving)
-------------------------------------------------------------- */
clearSelectionBtn.addEventListener('click', () => {
  state.playerId = null;
  state.quality = null;
  state.decision = null;

  [playerButtons, qualityButtons, decisionButtons].forEach(group => {
    group.querySelectorAll('button')
         .forEach(btn => btn.classList.remove('selected','danger','warning'));
  });

  updateSaveButton();
});

/* -------------------------------------------------------------
   SAVE POSSESSION
-------------------------------------------------------------- */
saveBtn.addEventListener('click', () => {
  if (!state.playerId || !state.quality || !state.decision) return;

  const player = players.find(p => p.id === state.playerId);

  state.possessions.push({
    playerId: state.playerId,
    playerNumber: player.number,
    playerName: player.name,
    role: player.role,
    quality: state.quality,
    decision: state.decision
  });

  clearSelectionBtn.click();
  renderLog();
  updateStats();
  updateReport();
});

/* -------------------------------------------------------------
   UNDO LAST (after saving)
-------------------------------------------------------------- */
undoLastBtn.addEventListener('click', () => {
  state.possessions.pop();
  renderLog();
  updateStats();
  updateReport();
});

/* -------------------------------------------------------------
   RESET QUARTER
-------------------------------------------------------------- */
resetQuarterBtn.addEventListener('click', () => {
  if (!confirm("Reset all possessions this quarter?")) return;
  state.possessions = [];
  renderLog();
  updateStats();
  updateReport();
});

/* -------------------------------------------------------------
   RENDER LOG
-------------------------------------------------------------- */
function renderLog() {
  logBody.innerHTML = '';
  state.possessions.forEach((pos, index) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${index+1}</td>
      <td>#${pos.playerNumber} ${pos.playerName}</td>
      <td>${pos.role}</td>
      <td>${pos.quality}</td>
      <td>${pos.decision}</td>
    `;
    logBody.appendChild(row);
  });
}

/* -------------------------------------------------------------
   STATS + REPORT
-------------------------------------------------------------- */
function updateStats() {
  const total = state.possessions.length;

  let roleP1=0, roleP2=0, roleNS=0;
  let g=0, o=0, p=0;
  let c=0, i=0;

  state.possessions.forEach(pos => {
    if (pos.role === 'P1') roleP1++;
    if (pos.role === 'P2') roleP2++;
    if (pos.role === 'NS') roleNS++;

    if (pos.quality === 'G') g++;
    if (pos.quality === 'O') o++;
    if (pos.quality === 'P') p++;

    if (pos.decision === 'C') c++;
    if (pos.decision === 'I') i++;
  });

  statsRow.innerHTML = '';

  const goodShots = g + o;
  const correctPerc = perc(c,total);
  const goodShotPerc = perc(goodShots,total);

  function pill(text, cls="") {
    const div = document.createElement('div');
    div.classList.add('stat-pill');
    if (cls) div.classList.add(cls);
    div.textContent = text;
    statsRow.appendChild(div);
  }

  pill(`Total: ${total}`);
  pill(`P1: ${roleP1} (${perc(roleP1,total)}%)`);
  pill(`P2: ${roleP2} (${perc(roleP2,total)}%)`);
  pill(`NS: ${roleNS} (${perc(roleNS,total)}%)`, roleNS/total > 0.2 ? "bad" : "");

  pill(`G/O: ${goodShots}/${total} (${goodShotPerc}%)`,
       goodShotPerc>=70?"good":goodShotPerc<55?"bad":"" );

  pill(`Poor: ${p} (${perc(p,total)}%)`);

  let decisionClass = "";
  if (correctPerc>=75) decisionClass="good";
  else if (correctPerc<65) decisionClass="bad";
  else decisionClass="warn";

  pill(`Correct: ${c}/${total} (${correctPerc}%)`, decisionClass);

  finalizeQuarterBtn.disabled = total===0;
}

function updateReport() {
  const total = state.possessions.length;
  if (!total) {
    reportBox.value = "No possessions logged yet.";
    return;
  }

  let roleP1=0, roleP2=0, roleNS=0;
  let g=0, o=0, p=0;
  let c=0, i=0;

  state.possessions.forEach(pos => {
    if (pos.role === 'P1') roleP1++;
    if (pos.role === 'P2') roleP2++;
    if (pos.role === 'NS') roleNS++;

    if (pos.quality === 'G') g++;
    if (pos.quality === 'O') o++;
    if (pos.quality === 'P') p++;

    if (pos.decision === 'C') c++;
    if (pos.decision === 'I') i++;
  });

  const goodShots = g+o;

  const lines = [];
  lines.push(`Quarter ${state.currentQuarter} Shot Selection Report`);
  lines.push(`Total possessions: ${total}`);
  lines.push(``);
  lines.push(`Role distribution:`);
  lines.push(`- Primary (P1): ${roleP1} (${perc(roleP1,total)}%)`);
  lines.push(`- Secondary (P2): ${roleP2} (${perc(roleP2,total)}%)`);
  lines.push(`- Non-Shooter: ${roleNS} (${perc(roleNS,total)}%)`);
  lines.push(``);
  lines.push(`Shot quality:`);
  lines.push(`- Great/OK looks: ${goodShots}/${total} (${perc(goodShots,total)}%)`);
  lines.push(`- Poor shots: ${p} (${perc(p,total)}%)`);
  lines.push(``);
  lines.push(`Decision quality:`);
  lines.push(`- Correct decisions: ${c}/${total} (${perc(c,total)}%)`);
  lines.push(`- Incorrect: ${i} (${perc(i,total)}%)`);
  lines.push(``);
  lines.push(`Key Messages:`);

  if (roleNS/total > 0.2)
    lines.push(`- Too many NS shots — get ball to P1/P2.`);
  else
    lines.push(`- Shot distribution acceptable.`);

  if (perc(goodShots,total) < 55)
    lines.push(`- Too many poor shots — get paint touch before scoring.`);
  else if (perc(goodShots,total)>=70)
    lines.push(`- Strong shot quality — keep driving/kicking.`);

  if (perc(c,total)<65)
    lines.push(`- Decision recognition below target — better identify the right shooter.`);
  else if (perc(c,total)>=75)
    lines.push(`- Strong decision making — keep it up.`);

  reportBox.value = lines.join("\n");
}

/* -------------------------------------------------------------
   COPY REPORT
-------------------------------------------------------------- */
copyReportBtn.addEventListener('click', async () => {
  try {
    await navigator.clipboard.writeText(reportBox.value);
    copyReportBtn.textContent = "Copied!";
    setTimeout(()=>copyReportBtn.textContent="Copy Text",1200);
  } catch(e) {
    alert("Copy not supported on this browser");
  }
});

/* -------------------------------------------------------------
   FINALIZE QUARTER
-------------------------------------------------------------- */
finalizeQuarterBtn.addEventListener('click', () => {
  if (state.possessions.length === 0) return;

  const box = document.createElement('div');
  box.classList.add('quarter-box');

  box.innerHTML = `
    <div class="quarter-header">
      <span>Quarter ${state.currentQuarter} Summary</span>
      <span class="quarter-tag">Q${state.currentQuarter}</span>
    </div>
    <pre>${reportBox.value}</pre>
  `;

  archivesContainer.prepend(box);

  // Next quarter
  state.currentQuarter++;
  updateQuarterLabel();

  // Reset possessions
  state.possessions = [];
  renderLog();
  updateStats();
  updateReport();
  finalizeQuarterBtn.disabled = true;
});

/* -------------------------------------------------------------
   INITIALISE
-------------------------------------------------------------- */
updateQuarterLabel();
updateStats();
updateReport();
</script>

</body>
</html>
