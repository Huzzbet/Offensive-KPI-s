<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shot Decision Tracker</title>
  <!-- Chart.js for the live graph -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: radial-gradient(circle at top, #1d2a3f 0, #020617 60%, #000 100%);
      color: #f9fafb;
      display: flex;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1100px;
      background: #020617;
      border-radius: 28px;
      padding: 18px;
      box-shadow: 0 22px 45px rgba(0, 0, 0, 0.6);
    }

    h1 {
      font-size: 24px;
      margin: 0 0 6px;
      text-align: center;
    }
    .subheading {
      font-size: 13px;
      text-align: center;
      margin-bottom: 16px;
      color: #9ca3af;
    }

    /* Layout: graph + controls */
    .main-layout {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .graph-column,
    .form-column {
      width: 100%;
    }

    /* On iPad / wider screens, show side-by-side */
    @media (min-width: 900px) {
      .main-layout {
        flex-direction: row;
        align-items: flex-start;
      }
      .graph-column {
        flex: 0 0 46%;
        position: sticky;
        top: 72px;
        max-height: calc(100vh - 96px);
        overflow: hidden;
      }
      .form-column {
        flex: 1;
      }
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.08), transparent 55%),
                  #020617;
      border-radius: 20px;
      padding: 14px 16px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.8);
      margin-bottom: 10px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .card-title {
      font-size: 14px;
      font-weight: 600;
    }
    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: #e5e7eb;
    }

    /* Quarter tabs */
    .quarter-tabs {
      display: inline-flex;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 4px;
      gap: 4px;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }
    .quarter-tab {
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .quarter-tab.active {
      background: radial-gradient(circle at top, #22c55e, #15803d);
      color: #ecfdf5;
    }

    /* Graph legend */
    .legend {
      display: flex;
      gap: 16px;
      font-size: 11px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .legend-swatch {
      width: 10px;
      height: 10px;
      border-radius: 3px;
    }

    /* Player list */
    .player-list-title {
      font-size: 13px;
      margin-bottom: 6px;
    }
    .player-list-sub {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 8px;
    }

    .player-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 320px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .player-card {
      border-radius: 16px;
      padding: 10px 12px;
      background: linear-gradient(135deg, #020617, #020617);
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      flex-direction: column;
      gap: 2px;
      cursor: pointer;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s, transform 0.05s;
    }
    .player-card:hover {
      border-color: rgba(52, 211, 153, 0.7);
    }
    .player-card.selected {
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.28), #020617);
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5), 0 14px 30px rgba(5, 46, 22, 0.9);
      transform: translateY(-1px);
    }
    .player-number {
      font-size: 12px;
      opacity: 0.8;
    }
    .player-name {
      font-weight: 600;
      font-size: 14px;
    }
    .role-pill {
      align-self: flex-start;
      margin-top: 2px;
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid;
    }
    .role-primary {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.25);
    }
    .role-secondary {
      border-color: rgba(59, 130, 246, 0.7);
      color: #bfdbfe;
      background: rgba(37, 99, 235, 0.25);
    }
    .role-non {
      border-color: rgba(168, 85, 247, 0.7);
      color: #e9d5ff;
      background: rgba(147, 51, 234, 0.25);
    }

    /* Pill button groups */
    .section-label {
      font-size: 13px;
      margin-bottom: 4px;
    }
    .section-help {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 6px;
    }
    .pill-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .pill-button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: #020617;
      padding: 6px 14px;
      font-size: 12px;
      color: #e5e7eb;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s, box-shadow 0.15s, transform 0.05s;
    }
    .pill-button:hover {
      border-color: rgba(52, 211, 153, 0.6);
    }
    .pill-button.active {
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.7), 0 12px 25px rgba(5, 46, 22, 0.9);
      transform: translateY(-1px);
    }
    .pill-button[data-type="shot"][data-value="G"].active {
      background: radial-gradient(circle at top, #22c55e, #15803d);
    }
    .pill-button[data-type="shot"][data-value="O"].active {
      background: radial-gradient(circle at top, #eab308, #a16207);
    }
    .pill-button[data-type="shot"][data-value="P"].active {
      background: radial-gradient(circle at top, #ef4444, #991b1b);
    }
    .pill-button[data-type="decision"][data-value="C"].active {
      background: radial-gradient(circle at top, #38bdf8, #0369a1);
    }
    .pill-button[data-type="decision"][data-value="I"].active {
      background: radial-gradient(circle at top, #f97316, #9a3412);
    }

    /* Save / Undo buttons */
    .actions-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .primary-btn,
    .secondary-btn {
      flex: 1;
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.05s, box-shadow 0.15s, opacity 0.15s;
      white-space: nowrap;
    }
    .primary-btn {
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      color: #ecfdf5;
      box-shadow: 0 16px 35px rgba(5, 46, 22, 0.9);
      font-weight: 600;
    }
    .primary-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 20px 40px rgba(4, 47, 17, 1);
    }
    .secondary-btn {
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }
    .secondary-btn:hover:not(.disabled) {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(15, 23, 42, 0.8);
    }
    .secondary-btn.disabled {
      opacity: 0.45;
      cursor: default;
    }

    /* Footer link */
    .footer-link {
      margin-top: 14px;
      text-align: center;
    }
    .footer-link a {
      display: inline-block;
      padding: 7px 14px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 11px;
      color: #e5e7eb;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <h1>Shot Decision Tracker</h1>
    <div class="subheading">
      Player · Shot Quality · Decision Quality (Roles: Primary / Secondary / Non-Shooter)
    </div>

    <div class="main-layout">
      <!-- GRAPH COLUMN (sticky on iPad landscape) -->
      <div class="graph-column">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Quarter Overview</div>
              <div style="font-size:11px;color:#9ca3af;margin-top:2px;">
                P1/P2 usage · Great looks · Correct decisions
              </div>
            </div>
            <div class="quarter-tabs">
              <button class="quarter-tab active" data-quarter="1">Q1</button>
              <button class="quarter-tab" data-quarter="2">Q2</button>
              <button class="quarter-tab" data-quarter="3">Q3</button>
              <button class="quarter-tab" data-quarter="4">Q4</button>
            </div>
          </div>
          <canvas id="quarterChart" style="width:100%;height:220px;"></canvas>
          <div class="legend">
            <div class="legend-item">
              <div class="legend-swatch" style="background:#22c55e;"></div>
              <span>P1/P2 Shot %</span>
            </div>
            <div class="legend-item">
              <div class="legend-swatch" style="background:#38bdf8;"></div>
              <span>Great Look %</span>
            </div>
            <div class="legend-item">
              <div class="legend-swatch" style="background:#a855f7;"></div>
              <span>Correct Decision %</span>
            </div>
          </div>
        </div>
      </div>

      <!-- FORM COLUMN -->
      <div class="form-column">
        <!-- Player selection -->
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">1. Player</div>
              <div class="player-list-sub">
                Tap the player who finished the possession (Primary / Secondary / Non-Shooter)
              </div>
            </div>
            <span class="pill" id="currentQuarterLabel">Q1</span>
          </div>

          <div class="player-list" id="playerList"></div>
        </div>

        <!-- Shot quality -->
        <div class="card">
          <div class="section-label">2. Shot Quality</div>
          <div class="section-help">G = great look · O = OK look · P = poor / forced</div>
          <div class="pill-row">
            <button class="pill-button" data-type="shot" data-value="G">G Great</button>
            <button class="pill-button" data-type="shot" data-value="O">O OK</button>
            <button class="pill-button" data-type="shot" data-value="P">P Poor</button>
          </div>
        </div>

        <!-- Decision quality -->
        <div class="card">
          <div class="section-label">3. Decision Quality</div>
          <div class="section-help">C = correct player/shot · I = incorrect choice</div>
          <div class="pill-row">
            <button class="pill-button" data-type="decision" data-value="C">C Correct</button>
            <button class="pill-button" data-type="decision" data-value="I">I Incorrect</button>
          </div>
        </div>

        <!-- Save / Undo -->
        <div class="card">
          <div class="section-label">4. Save Possession</div>
          <div class="section-help">
            Save the possession once Player, Shot Quality, and Decision Quality are selected.
          </div>
          <div class="actions-row">
            <button class="primary-btn" id="saveBtn">＋ Save Possession</button>
            <button class="secondary-btn disabled" id="undoBtn">↺ Undo Last</button>
          </div>
        </div>

        <div class="footer-link">
          <a href="https://huzzbet.github.io" target="_blank" rel="noopener">huzzbet.github.io</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ----- DATA -----
    const players = [
      { id: 21, number: "#21", name: "Billy Barton", role: "PRIMARY" },
      { id: 22, number: "#22", name: "Oliver Mann", role: "SECONDARY" },
      { id: 0,  number: "#–", name: "Sam Martin", role: "PRIMARY" },
      { id: 9,  number: "#9", name: "Tom D'Amelio", role: "NON" },
      { id: 1,  number: "#–", name: "Tom Darcy", role: "NON" },
      { id: 41, number: "#41", name: "Tyler Langston", role: "SECONDARY" },
      // add more if needed
    ];

    let state = {
      currentQuarter: 1,
      selectedPlayerId: null,
      selectedShot: null,     // 'G','O','P'
      selectedDecision: null  // 'C','I'
    };

    const possessions = []; // each: {quarter, playerId, role, shot, decision, ts}
    const quarterStats = {
      1: { total: 0, p1p2: 0, great: 0, correct: 0 },
      2: { total: 0, p1p2: 0, great: 0, correct: 0 },
      3: { total: 0, p1p2: 0, great: 0, correct: 0 },
      4: { total: 0, p1p2: 0, great: 0, correct: 0 }
    };

    // ----- DOM HELPERS -----
    const playerListEl = document.getElementById("playerList");
    const saveBtn = document.getElementById("saveBtn");
    const undoBtn = document.getElementById("undoBtn");
    const currentQuarterLabel = document.getElementById("currentQuarterLabel");
    const quarterTabs = document.querySelectorAll(".quarter-tab");
    const pillButtons = document.querySelectorAll(".pill-button");

    // ----- BUILD PLAYER LIST -----
    function renderPlayers() {
      playerListEl.innerHTML = "";
      players.forEach((p) => {
        const card = document.createElement("div");
        card.className = "player-card";
        card.dataset.playerId = p.id;

        const num = document.createElement("div");
        num.className = "player-number";
        num.textContent = p.number;
        const name = document.createElement("div");
        name.className = "player-name";
        name.textContent = p.name;
        const role = document.createElement("div");
        role.className =
          "role-pill " +
          (p.role === "PRIMARY"
            ? "role-primary"
            : p.role === "SECONDARY"
            ? "role-secondary"
            : "role-non");
        role.textContent =
          p.role === "PRIMARY"
            ? "PRIMARY"
            : p.role === "SECONDARY"
            ? "SECONDARY"
            : "NON-SHOOTER";

        card.appendChild(num);
        card.appendChild(name);
        card.appendChild(role);

        card.addEventListener("click", () => {
          state.selectedPlayerId = p.id;
          document
            .querySelectorAll(".player-card")
            .forEach((el) => el.classList.remove("selected"));
          card.classList.add("selected");
        });

        playerListEl.appendChild(card);
      });
    }

    // ----- PILL BUTTON HANDLERS -----
    pillButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const type = btn.dataset.type;
        const value = btn.dataset.value;

        // toggle group
        pillButtons.forEach((b) => {
          if (b.dataset.type === type) b.classList.remove("active");
        });
        btn.classList.add("active");

        if (type === "shot") {
          state.selectedShot = value;
        } else if (type === "decision") {
          state.selectedDecision = value;
        }
      });
    });

    // ----- QUARTER TABS -----
    quarterTabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        quarterTabs.forEach((t) => t.classList.remove("active"));
        tab.classList.add("active");
        state.currentQuarter = Number(tab.dataset.quarter);
        currentQuarterLabel.textContent = "Q" + state.currentQuarter;
        updateChartForSelectedQuarter();
      });
    });

    // ----- CHART SETUP -----
    const ctx = document.getElementById("quarterChart").getContext("2d");
    const chartData = {
      labels: ["Q1", "Q2", "Q3", "Q4"],
      datasets: [
        {
          label: "P1/P2 Shot %",
          data: [0, 0, 0, 0],
          backgroundColor: "#22c55e"
        },
        {
          label: "Great Look %",
          data: [0, 0, 0, 0],
          backgroundColor: "#38bdf8"
        },
        {
          label: "Correct Decision %",
          data: [0, 0, 0, 0],
          backgroundColor: "#a855f7"
        }
      ]
    };

    const quarterChart = new Chart(ctx, {
      type: "bar",
      data: chartData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            ticks: {
              color: "#9ca3af",
              callback: (value) => value + "%"
            },
            grid: {
              color: "rgba(148,163,184,0.2)"
            }
          },
          x: {
            ticks: { color: "#9ca3af" },
            grid: { display: false }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (ctx) => ctx.parsed.y.toFixed(0) + "%"
            }
          }
        }
      }
    });

    function recomputeQuarterStats() {
      // Reset
      Object.keys(quarterStats).forEach((q) => {
        quarterStats[q].total = 0;
        quarterStats[q].p1p2 = 0;
        quarterStats[q].great = 0;
        quarterStats[q].correct = 0;
      });

      possessions.forEach((pos) => {
        const q = pos.quarter;
        const qs = quarterStats[q];
        qs.total += 1;
        if (pos.role === "PRIMARY" || pos.role === "SECONDARY") qs.p1p2 += 1;
        if (pos.shot === "G") qs.great += 1;
        if (pos.decision === "C") qs.correct += 1;
      });

      // Update chart data
      [1, 2, 3, 4].forEach((q, idx) => {
        const qs = quarterStats[q];
        if (qs.total === 0) {
          chartData.datasets[0].data[idx] = 0;
          chartData.datasets[1].data[idx] = 0;
          chartData.datasets[2].data[idx] = 0;
        } else {
          chartData.datasets[0].data[idx] = (qs.p1p2 / qs.total) * 100;
          chartData.datasets[1].data[idx] = (qs.great / qs.total) * 100;
          chartData.datasets[2].data[idx] = (qs.correct / qs.total) * 100;
        }
      });

      quarterChart.update();
    }

    function updateChartForSelectedQuarter() {
      // For now chart already shows all quarters; this function can be used
      // later if you want to highlight the active quarter.
      quarterChart.update();
    }

    // ----- SAVE / UNDO -----
    function clearSelection() {
      state.selectedPlayerId = null;
      state.selectedShot = null;
      state.selectedDecision = null;

      document
        .querySelectorAll(".player-card")
        .forEach((el) => el.classList.remove("selected"));
      pillButtons.forEach((b) => b.classList.remove("active"));
    }

    function updateUndoButton() {
      if (possessions.length === 0) {
        undoBtn.classList.add("disabled");
      } else {
        undoBtn.classList.remove("disabled");
      }
    }

    saveBtn.addEventListener("click", () => {
      if (!state.selectedPlayerId || !state.selectedShot || !state.selectedDecision) {
        alert("Please select Player, Shot Quality, and Decision Quality before saving.");
        return;
      }

      const player = players.find((p) => p.id === state.selectedPlayerId);
      const pos = {
        quarter: state.currentQuarter,
        playerId: player.id,
        role: player.role,
        shot: state.selectedShot,
        decision: state.selectedDecision,
        ts: Date.now()
      };
      possessions.push(pos);

      recomputeQuarterStats();
      updateChartForSelectedQuarter();
      updateUndoButton();
      clearSelection();
    });

    undoBtn.addEventListener("click", () => {
      if (possessions.length === 0) return;
      if (undoBtn.classList.contains("disabled")) return;

      possessions.pop(); // remove last saved possession
      recomputeQuarterStats();
      updateChartForSelectedQuarter();
      updateUndoButton();
    });

    // ----- INIT -----
    renderPlayers();
    recomputeQuarterStats();
    updateUndoButton();
  </script>
</body>
</html>